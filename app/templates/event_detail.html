{% extends "layout.html" %}

{% block content %}
<div class="container">
    <div class="event-detail">
        <h1>{{ event.title }}</h1>
        <p>{{ event.description }}</p>
        <p><strong>Start Date:</strong> {{ event.start_date.strftime("%Y-%m-%d %H:%M") }}</p>
        <p><strong>End Date:</strong> {{ event.end_date.strftime("%Y-%m-%d %H:%M") }}</p>

        {% if has_joined %}
            <p>Total Completed Tasks Points: {{ total_points }}</p>
            <a href="{{ url_for('events.add_task', event_id=event.id) }}" class="button">Add Task</a>
            {% for task in event.tasks %}
            <div class="task">
                <strong>{{ task.title }}</strong> - {{ task.description }} ({{ task.points }} points)
                {% set user_task = task_users[task.id] if task.id in task_users else None %}
                {% if user_task %}
                    <span>âœ“ Completed</span>
                    <form action="{{ url_for('events.complete_task', task_id=task.id) }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="button warning">Mark as Not Completed</button>
                    </form>
                {% else %}
                    <form action="{{ url_for('events.complete_task', task_id=task.id) }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="button success">Mark as Completed</button>
                    </form>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <form action="{{ url_for('events.register_event', event_id=event.id) }}" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <button type="submit" class="button primary">Join Event</button>
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}
