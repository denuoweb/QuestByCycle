import{o as f,s as b,a as E}from"./main.js";import{l as g}from"./chunk-Bu8AA3up.js";let m=null,p="points",i;function L(o){const t=document.getElementById("leaderboardModalContent");if(!t){g.error("Leaderboard modal content element not found. Cannot proceed with displaying leaderboard."),alert("Leaderboard modal content element not found. Please ensure the page has loaded completely and the correct ID is used.");return}fetch("/leaderboard_partial?game_id="+o,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(e=>{if(e.status===401)return window.location.href="/auth/login?next="+encodeURIComponent(window.location.pathname),null;if(!e.ok)throw new Error("Failed to fetch leaderboard data");return e.json()}).then(e=>{e&&(t.innerHTML="",m=e,p="points",_(t,e,o),x(t,e,o),M(t),y(t),C(),f("leaderboardModal"))}).catch(e=>{g.error("Failed to load leaderboard:",e),alert("Failed to load leaderboard data. Please try again.")})}function _(o,t,e){if(t.games&&t.games.length>1){const n=document.createElement("form");n.method="get",n.action="#";const a=document.createElement("label");a.for="game_Select",a.textContent="Select Game:",n.appendChild(a);const l=document.createElement("select");l.name="game_id",l.id="game_Select",l.className="form-control",l.onchange=()=>n.submit(),t.games.forEach(d=>{const r=document.createElement("option");r.value=d.id,r.textContent=d.title,r.selected=d.id===e,l.appendChild(r)}),n.appendChild(l),o.appendChild(n)}}function M(o){const t=document.createElement("div");t.className="form-check form-switch my-3";const e=document.createElement("input");e.className="form-check-input",e.type="checkbox",e.id="metricToggle";const n=document.createElement("label");n.className="form-check-label",n.htmlFor="metricToggle",n.textContent="Show Completed Quests",e.addEventListener("change",()=>{p=e.checked?"quests":"points",C()}),t.appendChild(e),t.appendChild(n),o.appendChild(t)}function y(o){const t=document.createElement("table");t.className="table table-striped";const e=document.createElement("thead"),n=document.createElement("tr");["Rank","Player","Points"].forEach((a,l)=>{const d=document.createElement("th");l===2&&(d.id="leaderboardMetricHeader"),d.textContent=a,n.appendChild(d)}),e.appendChild(n),t.appendChild(e),i=document.createElement("tbody"),t.appendChild(i),o.appendChild(t)}function h(o,t,e=!1,n=null){const a=document.createElement("td");if(e){const l=document.createElement("a");l.href="javascript:void(0)",l.onclick=()=>E(n),l.textContent=t,a.appendChild(l)}else a.textContent=t;o.appendChild(a)}function x(o,t,e){if(t.total_game_points&&t.game_goal){const n=document.createElement("div");n.className="completion-meter-container";const a=document.createElement("div");a.className="inspirational-text",a.textContent="It takes a village to enact changeâ€¦",n.appendChild(a);const l=t.game_goal-t.total_game_points,d=Math.min(t.total_game_points/t.game_goal*100,100),r=document.createElement("div");r.className="meter-label",r.textContent=`Carbon Reduction Points: ${t.total_game_points} / ${t.game_goal} (Remaining: ${l})`,n.appendChild(r);const s=document.createElement("div");s.className="completion-meter",s.id="completionMeter",s.addEventListener("click",()=>b(e));const u=document.createElement("div");u.className="click-text",u.textContent="Click to view all game submissions!",s.appendChild(u);const c=document.createElement("div");c.className="meter-bar",c.id="meterBar",c.style.height="0%",c.style.opacity="1",c.dataset.label=`${d.toFixed(1)}% Reduced`,s.appendChild(c),n.appendChild(s),o.appendChild(n),setTimeout(()=>{c.style.height=`${d}%`,c.style.opacity=`${1-d/100}`,k(d,e)},100)}}function k(o,t){const e=document.getElementById("completionMeter"),n=9-Math.min(Math.floor(o/10),9);e.style.backgroundImage=`url('/static/images/leaderboard/smoggy_skyline_${t}_${n}.png')`}function C(){if(!m||!i)return;if(!m.top_users||m.top_users.length===0){i.innerHTML="";const e=document.createElement("tr"),n=document.createElement("td");n.colSpan=3,n.textContent="Join a game to see the leaderboard!",e.appendChild(n),i.appendChild(e);return}i.innerHTML="";const o=document.getElementById("leaderboardMetricHeader");o&&(o.textContent=p==="quests"?"Quests Completed":"Points");const t=[...m.top_users];t.sort((e,n)=>p==="quests"?n.completed_quests-e.completed_quests:n.total_points-e.total_points),t.forEach((e,n)=>{const a=document.createElement("tr");h(a,n+1);const l=e.display_name||e.username;h(a,l,!0,e.user_id);const d=p==="quests"?e.completed_quests:e.total_points;h(a,d),i.appendChild(a)})}export{L as showLeaderboardModal};
