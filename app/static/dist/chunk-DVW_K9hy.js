import{o as b,s as f,a as E}from"./main.js";import{l as g}from"./chunk-Bu8AA3up.js";let m=null,p="points",i;async function L(o){const e=document.getElementById("leaderboardModalContent");if(!e){g.error("Leaderboard modal content element not found. Cannot proceed with displaying leaderboard."),alert("Leaderboard modal content element not found. Please ensure the page has loaded completely and the correct ID is used.");return}try{const n=await fetch(`/leaderboard_partial?game_id=${o}`,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(n.status===401){window.location.href="/auth/login?next="+encodeURIComponent(window.location.pathname);return}if(!n.ok)throw new Error("Failed to fetch leaderboard data");const t=await n.json();e.innerHTML="",m=t,p="points",_(e,t,o),x(e,t,o),y(e),M(e),C(),b("leaderboardModal")}catch(n){g.error("Failed to load leaderboard:",n),alert("Failed to load leaderboard data. Please try again.")}}function _(o,e,n){if(e.games&&e.games.length>1){const t=document.createElement("form");t.method="get",t.action="#";const a=document.createElement("label");a.for="game_Select",a.textContent="Select Game:",t.appendChild(a);const l=document.createElement("select");l.name="game_id",l.id="game_Select",l.className="form-control",l.onchange=()=>t.submit(),e.games.forEach(d=>{const r=document.createElement("option");r.value=d.id,r.textContent=d.title,r.selected=d.id===n,l.appendChild(r)}),t.appendChild(l),o.appendChild(t)}}function y(o){const e=document.createElement("div");e.className="form-check form-switch my-3";const n=document.createElement("input");n.className="form-check-input",n.type="checkbox",n.id="metricToggle";const t=document.createElement("label");t.className="form-check-label",t.htmlFor="metricToggle",t.textContent="Show Completed Quests",n.addEventListener("change",()=>{p=n.checked?"quests":"points",C()}),e.appendChild(n),e.appendChild(t),o.appendChild(e)}function M(o){const e=document.createElement("table");e.className="table table-striped";const n=document.createElement("thead"),t=document.createElement("tr");["Rank","Player","Points"].forEach((a,l)=>{const d=document.createElement("th");l===2&&(d.id="leaderboardMetricHeader"),d.textContent=a,t.appendChild(d)}),n.appendChild(t),e.appendChild(n),i=document.createElement("tbody"),e.appendChild(i),o.appendChild(e)}function h(o,e,n=!1,t=null){const a=document.createElement("td");if(n){const l=document.createElement("a");l.href="javascript:void(0)",l.onclick=()=>E(t),l.textContent=e,a.appendChild(l)}else a.textContent=e;o.appendChild(a)}function x(o,e,n){if(e.total_game_points&&e.game_goal){const t=document.createElement("div");t.className="completion-meter-container";const a=document.createElement("div");a.className="inspirational-text",a.textContent="It takes a village to enact changeâ€¦",t.appendChild(a);const l=e.game_goal-e.total_game_points,d=Math.min(e.total_game_points/e.game_goal*100,100),r=document.createElement("div");r.className="meter-label",r.textContent=`Carbon Reduction Points: ${e.total_game_points} / ${e.game_goal} (Remaining: ${l})`,t.appendChild(r);const s=document.createElement("div");s.className="completion-meter",s.id="completionMeter",s.addEventListener("click",()=>f(n));const u=document.createElement("div");u.className="click-text",u.textContent="Click to view all game submissions!",s.appendChild(u);const c=document.createElement("div");c.className="meter-bar",c.id="meterBar",c.style.height="0%",c.style.opacity="1",c.dataset.label=`${d.toFixed(1)}% Reduced`,s.appendChild(c),t.appendChild(s),o.appendChild(t),setTimeout(()=>{c.style.height=`${d}%`,c.style.opacity=`${1-d/100}`,w(d,n)},100)}}function w(o,e){const n=document.getElementById("completionMeter"),t=9-Math.min(Math.floor(o/10),9);n.style.backgroundImage=`url('/static/images/leaderboard/smoggy_skyline_${e}_${t}.png')`}function C(){if(!m||!i)return;if(!m.top_users||m.top_users.length===0){i.innerHTML="";const n=document.createElement("tr"),t=document.createElement("td");t.colSpan=3,t.textContent="Join a game to see the leaderboard!",n.appendChild(t),i.appendChild(n);return}i.innerHTML="";const o=document.getElementById("leaderboardMetricHeader");o&&(o.textContent=p==="quests"?"Quests Completed":"Points");const e=[...m.top_users];e.sort((n,t)=>p==="quests"?t.completed_quests-n.completed_quests:t.total_points-n.total_points),e.forEach((n,t)=>{const a=document.createElement("tr");h(a,t+1);const l=n.display_name||n.username;h(a,l,!0,n.user_id);const d=p==="quests"?n.completed_quests:n.total_points;h(a,d),i.appendChild(a)})}export{L as showLeaderboardModal};
