function d(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}async function u(e,o={}){const s={credentials:"same-origin",...o},r=await fetch(e,s),i=await r.json().catch(()=>({}));return{status:r.status,json:i}}function m(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}typeof window<"u"&&(window.getCSRFToken=d,window.fetchJson=u,window.escapeHTML=m);function f(){console.debug("Showing loading modal"),document.getElementById("loadingModal").style.display="flex"}function g(){console.debug("Hiding loading modal"),document.getElementById("loadingModal").style.display="none"}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("submitPhotoForm");if(!e){console.error("submitPhotoForm element not found on page.");return}let o=!1;e.addEventListener("submit",function(r){if(r.preventDefault(),o)return;o=!0;const i=e.querySelector('input[name="photo"]'),t=i?i.files[0]:null;if(t&&t.type.startsWith("video/")&&t.size>10*1024*1024){s("Video must be 10 MB or smaller.","error"),o=!1;return}if(t&&t.type.startsWith("image/")&&t.size>8*1024*1024){s("Image must be 8 MB or smaller.","error"),o=!1;return}f();const a=new FormData(e),l=getCSRFToken();a.append("csrf_token",l),fetch(e.action,{method:"POST",body:a,credentials:"same-origin",headers:{"X-CSRF-Token":l}}).then(n=>n.ok?n.json():n.json().then(c=>{throw new Error(c.message)})).then(n=>{n.success?(s(n.message,"success"),window.location.href=n.redirect_url):s(n.message,"error")}).catch(n=>{console.error("Submission error:",n),s("Error during submission: "+n.message,"error")}).finally(()=>{o=!1,g()})});function s(r,i){const t=document.getElementById("flash-messages");t?t.innerHTML=`
                <div class="flash-message ${i}">
                    ${r}
                </div>
            `:console.warn("Flash messages container not found.")}});export{g as h,f as s};
