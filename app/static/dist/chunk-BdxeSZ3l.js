const C="modulepreload",S=function(e){return"/static/dist/"+e},b={},_=function(t,n,o){let s=Promise.resolve();if(n&&n.length>0){let i=function(r){return Promise.all(r.map(c=>Promise.resolve(c).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),m=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=i(n.map(r=>{if(r=S(r),r in b)return;b[r]=!0;const c=r.endsWith(".css"),w=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${w}`))return;const g=document.createElement("link");if(g.rel=c?"stylesheet":C,c||(g.as="script"),g.crossOrigin="",g.href=r,m&&g.setAttribute("nonce",m),document.head.appendChild(g),c)return new Promise((L,B)=>{g.addEventListener("load",L),g.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${r}`)))})}))}function d(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return s.then(i=>{for(const a of i||[])a.status==="rejected"&&d(a.reason);return t().catch(d)})},l={log:(...e)=>console.log(...e),error:(...e)=>console.error(...e),warn:(...e)=>console.warn(...e),info:(...e)=>console.info(...e),debug:(...e)=>console.debug(...e)};let p=3e3,I=0;function u(e){var o;const t=document.getElementById(e);if(!t){l.error(`Modal ${e} not found`);return}document.body.appendChild(t),(o=document.querySelector(".container"))==null||o.classList.add("modal-open"),I=window.scrollY||window.pageYOffset,document.body.style.top=`-${I}px`,document.body.style.position="fixed",t.classList.add("active"),t.style.display="flex",p+=10,t.style.zIndex=p;const n=t.querySelector(".modal-backdrop");n&&(n.style.display="block",n.style.zIndex=p-1),document.body.classList.add("body-no-scroll")}function h(e){var o;const t=document.getElementById(e);if(!t)return;const n=t.querySelector(".modal-backdrop");t.style.display="none",n&&(n.style.display="none"),p=Math.max(1050,p-10),document.querySelector('.modal[style*="display: flex"]')||(document.body.classList.remove("body-no-scroll"),(o=document.querySelector(".container"))==null||o.classList.remove("modal-open"),document.body.style.position="",document.body.style.top="",window.scrollTo(0,I)),t.dispatchEvent(new CustomEvent("hidden.bs.modal",{bubbles:!0}))}function U(){const e=document.getElementById("twitterLink");e&&(e.style.display="none",e.href="#");const t=document.getElementById("facebookLink");t&&(t.style.display="none",t.href="#");const n=document.getElementById("instagramLink");n&&(n.style.display="none",n.href="#");const o=document.getElementById("modalQuestActions");o&&(o.innerHTML=""),document.querySelectorAll('[id^="verifyButton-"]').forEach(s=>s.remove()),document.querySelectorAll('[id^="verifyQuestForm-"]').forEach(s=>s.remove()),document.body.classList.remove("body-no-scroll")}function x(e,t){const n=document.getElementById(e);if(n){if(t.gameId!==void 0){const o=n.querySelector('input[name="game_id"]');o&&(o.value=t.gameId)}if(t.questId!==void 0){const o=n.querySelector('input[name="quest_id"]');o&&(o.value=t.questId)}if(t.next!==void 0){const o=n.querySelector('input[name="next"]');o&&(o.value=t.next)}}}function k(e){x("loginModal",e),u("loginModal")}function E(e={}){const t=document.getElementById("registerForm"),n=t.getAttribute("action").split("?")[0],o=[];e.gameId&&o.push(`game_id=${encodeURIComponent(e.gameId)}`),e.questId&&o.push(`quest_id=${encodeURIComponent(e.questId)}`),e.next&&o.push(`next=${encodeURIComponent(e.next)}`),e.showJoinCustom!==void 0&&o.push(`show_join_custom=${encodeURIComponent(e.showJoinCustom)}`),t.setAttribute("action",n+(o.length?`?${o.join("&")}`:"")),e.gameId!==void 0&&(document.getElementById("registerGameId").value=e.gameId),e.questId!==void 0&&(document.getElementById("registerQuestId").value=e.questId),e.next!==void 0&&(document.getElementById("registerNext").value=e.next),e.showJoinCustom!==void 0&&(document.getElementById("registerShowJoinCustom").value=e.showJoinCustom),h("loginModal"),u("registerModal")}function v({gameId:e,questId:t="",nextPath:n=null}){const o=document.getElementById("loginForm"),s=document.getElementById("loginGameId"),d=document.getElementById("loginQuestId"),i=document.getElementById("loginNext"),a=document.getElementById("loginShowJoinCustom"),m=n??`/?game_id=${encodeURIComponent(e)}&show_join_custom=0`;s.value=e,d.value=t,a.value="0",i.value=m;const r=o.getAttribute("action").split("?")[0],c=new URLSearchParams({game_id:e,quest_id:t,show_join_custom:0,next:m});o.setAttribute("action",`${r}?${c.toString()}`),u("loginModal")}function $(){const e=document.getElementById("loginGameId").value||"",t=document.getElementById("loginQuestId").value||"",n=document.getElementById("loginNext").value||"",o=document.getElementById("loginShowJoinCustom").value||"",s=(document.getElementById("loginCustomGameCode")||{}).value||"";document.getElementById("registerGameId").value=e,document.getElementById("registerQuestId").value=t,document.getElementById("registerNext").value=n,document.getElementById("registerShowJoinCustom").value=o,document.getElementById("registerCustomGameCode").value=s;const d=document.getElementById("registerForm"),i=d.getAttribute("action").split("?")[0],a=new URLSearchParams;e&&a.set("game_id",e),t&&a.set("quest_id",t),n&&a.set("next",n),o&&a.set("show_join_custom",o),s&&a.set("custom_game_code",s),d.setAttribute("action",`${i}?${a.toString()}`),h("loginModal"),u("registerModal")}function J(){var d;const e=((d=document.getElementById("loginEmail"))==null?void 0:d.value)||"",t=document.getElementById("forgotEmail");t&&(t.value=e);const n=document.getElementById("forgotEmailError"),o=document.getElementById("forgotSuccess"),s=document.getElementById("forgotButton");n&&(n.style.display="none"),o&&(o.style.display="none"),s&&(s.disabled=!1),u("forgotPasswordModal")}function M(e){const t=document.getElementById("resetForm"),n=document.getElementById("resetToken"),o=t.dataset.baseAction;t.setAttribute("action",o+encodeURIComponent(e)),n.value=e,document.getElementById("resetError").style.display="none",document.getElementById("resetSuccess").style.display="none",document.getElementById("resetButton").disabled=!1,u("resetPasswordModal")}document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search);if(e.get("show_reset")==="1"){const t=e.get("token");t?(M(t),history.replaceState(null,"",window.location.pathname)):l.warn("show_reset=1 present but no token in URL")}});document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search),t=e.get("show_join_custom")==="1",n=e.has("game_id");t&&!n&&u("joinCustomGameModal")});document.addEventListener("DOMContentLoaded",()=>{const t=new URLSearchParams(window.location.search).get("quest_shortcut");t&&(_(()=>import("./chunk-ClF8AVyi.js").then(n=>n.q),[]).then(n=>n.openQuestDetailModal(t)),history.replaceState(null,"",window.location.pathname))});document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search);if(!(e.get("show_login")==="1"))return;const n=e.get("next")||"";let o=e.get("game_id")||"";if(!o&&n)try{const d=new URL(n,window.location.origin).pathname.replace(/^\/+/,"");/^\d+$/.test(d)&&(o=d)}catch(s){l.warn("Failed to parse next URL for gameId:",s)}v({gameId:o,questId:"",nextPath:n})});document.addEventListener("DOMContentLoaded",()=>{if(!window.location.pathname.startsWith("/auth/login"))return;const e=new URLSearchParams(window.location.search),t=e.get("next");if(!t)return;let n=e.get("game_id")||"";if(!n)try{const s=new URL(t,window.location.origin).pathname.replace(/^\/+/,"");/^\d+$/.test(s)&&(n=s)}catch(o){l.warn("Could not parse next URL for gameId:",o)}n&&v({gameId:n,questId:"",nextPath:t})});async function q(e,t){try{const n=await fetch(e,{credentials:"same-origin"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.text(),s=document.getElementById(t);s&&s.parentNode.removeChild(s);const d=document.createElement("div");d.innerHTML=o.trim();const i=d.firstElementChild;(!i||i.id!==t)&&l.warn(`Expected first element to be #${t}`,i),document.body.appendChild(i),u(t)}catch(n){l.error(`Error loading ${t} from ${e}:`,n),alert("Failed to load data. Please try again later.")}}async function j(e){const t=await fetch(e.action,{method:e.method||"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:new FormData(e),credentials:"same-origin"});if(!(t.headers.get("content-type")||"").includes("application/json"))return window.location.href=t.url,{status:t.status,json:{}};const o=await t.json();return{status:t.status,json:o}}document.addEventListener("click",e=>{const t=e.target.closest("[data-close-modal]");if(!t)return;e.preventDefault();const n=t.getAttribute("data-close-modal");n&&h(n)});document.addEventListener("click",e=>{const t=e.target.closest("[data-open-modal]");t&&(e.preventDefault(),u(t.getAttribute("data-open-modal")))});document.addEventListener("click",e=>{e.target.closest("[data-open-register]")&&(e.preventDefault(),E({showJoinCustom:1,next:"/?show_join_custom=1"}))});document.addEventListener("keydown",e=>{e.target.closest("[data-open-register]")&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),E({showJoinCustom:1,next:"/?show_join_custom=1"}))});document.addEventListener("click",e=>{const t=e.target.closest("[data-login-game]");if(!t)return;e.preventDefault();const n=t.getAttribute("data-login-game"),o=`/?game_id=${encodeURIComponent(n)}&show_join_custom=0`;E({gameId:n,showJoinCustom:0,next:o})});document.addEventListener("keydown",e=>{const t=e.target.closest("[data-login-game]");if(t&&(e.key==="Enter"||e.key===" ")){e.preventDefault();const n=t.getAttribute("data-login-game"),o=`/?game_id=${encodeURIComponent(n)}&show_join_custom=0`;E({gameId:n,showJoinCustom:0,next:o})}});document.addEventListener("click",e=>{var i,a,m,r;if(!e.target.closest("[data-open-login-from-register]"))return;e.preventDefault();const n=((i=document.getElementById("registerGameId"))==null?void 0:i.value)||"",o=((a=document.getElementById("registerQuestId"))==null?void 0:a.value)||"",s=((m=document.getElementById("registerNext"))==null?void 0:m.value)||"",d=((r=document.getElementById("registerShowJoinCustom"))==null?void 0:r.value)||"";if(h("registerModal"),n)v({gameId:n,questId:o,nextPath:s});else{k({next:s});const c=document.getElementById("loginShowJoinCustom");c&&d&&(c.value=d)}});document.addEventListener("click",e=>{const t=e.target.closest("[data-modal-url]");if(!t)return;e.preventDefault();const n=t.getAttribute("data-modal-url"),o=t.getAttribute("data-modal-id");if(!n||!o){l.error("data-modal-url or data-modal-id missing",t);return}q(n,o)});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".modal").forEach(e=>{e.parentNode!==document.body&&document.body.appendChild(e)})});function R(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}async function A(e,t={}){const n={Accept:"application/json",...t.headers||{}},o={credentials:"same-origin",cache:"no-store",...t,headers:n},s=await fetch(e,o),d=await s.json().catch(()=>({}));return{status:s.status,json:d}}async function F(e,t={}){const n={...t.headers||{}};return n["X-CSRF-Token"]=R(),A(e,{...t,headers:n})}let f=0,y=null;function P(e){const t=document.getElementById("loadingStatus");t&&typeof e=="string"&&(t.textContent=e)}function D(e=null){e&&P(e),f===0&&(l.debug("Showing loading modal"),u("loadingModal")),f+=1,y&&clearTimeout(y),y=setTimeout(()=>{l.warn("Loading modal auto-hide triggered after timeout."),f=0,h("loadingModal")},3e4)}function T(){f>0&&(f-=1),f===0&&(l.debug("Hiding loading modal"),y&&(clearTimeout(y),y=null),h("loadingModal"))}export{_,D as a,h as b,F as c,J as d,U as e,A as f,R as g,T as h,l,u as o,$ as r,j as s};
